CREATE TABLE occ (dt datetime, site string, instr string, unavail int, total int, primary key (dt, site));
create view v_occ as select *, 1.0*unavail/total*100.0 as pct from occ;
create view v_date as select date(dt) as dt, site, count(*) as cnt, sum(unavail) as unavail, sum(total) as total, avg(pct) as pct from v_occ group by date(dt), site;

# get average occupancy by instructor
select inst, count(*), avg(pct) as avgpct from v_occ group by inst order by avgpct desc;

# get overall stats by site by date
select date(dt), site, avg(pct) from v_occ group by date(dt), site;
or
select * from v_date where dt='2014-07-08';

/* TODO: aggregate stats over different time periods

sqlite> 
sqlite> select site, sum(cnt) as ttlcnt, sum(unavail) as ttlunavail, sum(total) as ttltotal from v_date
   ...> group by site where dt between date('now', '-7 days') and date('now');
Error: near "where": syntax error
sqlite> select site, sum(cnt) as ttlcnt, sum(unavail) as ttlunavail, sum(total) as ttltotal from v_date
   ...> where dt between date('now', '-7 days') and date('now') group by site order by site;
sqlite> 
sqlite> where dt between date('now', '-60 days') and date('now') group by site order by site;
Error: near "where": syntax error


*/
